#!/bin/sh
ipfw -f flush

# Constants
lan="em1"
wan="em0"
lan_net="192.168.1.0/24"

# Prohibit SSH from the outside
ipfw add 100 deny tcp from any to me 22 in via ${wan}

# Prohibit access from the outside to the local DNS-server
ipfw add 200 deny udp from any to me 53 in via ${wan}
ipfw add 210 deny tcp from any to me 53 in via ${wan}

# NAT and deNAT
ipfw add 300 divert natd ip from any to any via ${wan}

# Loopback
ipfw add 400 allow ip from any to any via lo0

# Allow ICMP (ping)
ipfw add 500 allow icmp from any to any

# Allow DNS
ipfw add 600 allow udp from any to any 53
ipfw add 610 allow tcp from any to any 53
ipfw add 620 allow udp from any 53 to any
ipfw add 630 allow tcp from any 53 to any

# Allow HTTP/HTTPS
ipfw add 700 allow tcp from any to any 80
ipfw add 710 allow tcp from any 80 to any
ipfw add 720 allow tcp from any to any 443
ipfw add 730 allow tcp from any 443 to any

# Allow Squid
ipfw add 800 allow tcp from any to any 3128
ipfw add 810 allow tcp from any 3128 to any
